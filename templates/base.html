<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}CGRS{% endblock %}</title>
  <!-- Bootstrap CSS (optional) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/style.css">
  {% block extra_head %}{% endblock %}
</head>
<body>
  <div class="app-shell">
    <!-- Top navigation (Bootstrap) -->
    <!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center gap-2" href="{{ url_for('login') }}">
      <div class="logo" style="width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#0b62d0,#0058c2);color:#fff;font-weight:700">U</div>
      <div class="d-none d-lg-block">
        <div class="univ-name">Campus Grievance</div>
        <div class="univ-sub muted" style="font-size:12px">Student Portal</div>
      </div>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNavbar">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">

        <!-- Always visible -->
        <li class="nav-item">
        {% if not is_logged_in %}
          <a class="nav-link" href="{{ url_for('login') }}">Dashboard</a>
        {% else %}
          <a class="nav-link" href="{{
            url_for('student_dashboard') if session['role_id'] == 1 else
            url_for('admin_dashboard') if session['role_id'] == 2 else
            url_for('superadmin_dashboard')
            }}">
            Dashboard
          </a>
        {% endif %}
        </li>

        <!-- Show only when logged OUT -->
        {% if not is_logged_in %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('login') }}">Login</a>
          </li>

        <!-- Show when logged IN -->
        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('profile') }}">Profile</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

    <main class="main-layout">
      {% if is_logged_in and request.endpoint != 'login' %}
      <!-- SIDEBAR: only visible after login -->
      <aside class="sidebar" id="mainSidebar">
        <div class="sidebar-top">
          <button id="sidebarToggle" class="btn btn-ghost">‚ò∞</button>
        </div>

        <ul class="sidebar-nav">
          <li>
          {% if session['role_id'] == 1 %}
            <a href="{{ url_for('student_dashboard') }}" class="nav-link">
              <span class="side-icon">üè†</span><span class="side-label">Dashboard</span>
            </a>

          {% elif session['role_id'] == 2 %}
            <a href="{{ url_for('admin_dashboard') }}" class="nav-link">
              <span class="side-icon">üè†</span><span class="side-label">Dashboard</span>
            </a>

          {% elif session['role_id'] == 3 %}
            <a href="{{ url_for('superadmin_dashboard') }}" class="nav-link">
              <span class="side-icon">üè†</span><span class="side-label">Dashboard</span>
            </a>
          {% endif %}
          </li>

          <li><a href="{{ url_for('activity_log') }}" class="nav-link"><span class="side-icon">üìù</span><span class="side-label">Activity Log</span></a></li>

          {% if is_admin %}
          <li><a href="{{ url_for('reports') }}" class="nav-link"><span class="side-icon">üìä</span><span class="side-label">Reports</span></a></li>
          {% endif %}

          <li><a href="{{ url_for('logout') }}" class="nav-link"><span class="side-icon">‚Ü™</span><span class="side-label">Logout</span></a></li>
        </ul>
      </aside>
      {% endif %}


      <section class="content">
        <div class="page">
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              <div class="alerts">
                {% for category, message in messages %}
                  <div class="alert {{ category }}">{{ message }}</div>
                {% endfor %}
              </div>
            {% endif %}
          {% endwith %}

          {% block content %}{% endblock %}
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div>¬© {{ current_year if current_year else "2025" }} University ‚Äî All rights reserved</div>
      <div>Designed for a clean, accessible student dashboard.</div>
    </footer>
  </div>
  <!-- Bootstrap JS bundle (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="" crossorigin="anonymous"></script>
  <script>
    // Sidebar toggle behavior: toggles collapsed class and handles mobile open
    (function(){
      const toggle = document.getElementById('sidebarToggle');
      const sidebar = document.getElementById('mainSidebar');
      if(!toggle || !sidebar) return;
      // use aria attribute for css state
      function setCollapsed(val){
        sidebar.classList.toggle('collapsed', val);
        sidebar.setAttribute('aria-collapsed', val ? 'true' : 'false');
      }
      // initial state
      setCollapsed(false);
      toggle.addEventListener('click', function(e){
        // on small screens toggle open class
        if(window.innerWidth <= 600){
          sidebar.classList.toggle('open');
        } else {
          sidebar.classList.toggle('collapsed');
          const collapsed = sidebar.classList.contains('collapsed');
          sidebar.setAttribute('aria-collapsed', collapsed ? 'true' : 'false');
        }
      });
      // close mobile sidebar when clicking outside
      document.addEventListener('click', function(e){
        if(window.innerWidth <= 600 && sidebar.classList.contains('open')){
          if(!sidebar.contains(e.target) && e.target !== toggle){
            sidebar.classList.remove('open');
          }
        }
      });
    })();
  </script>
  {% block extra_scripts %}{% endblock %}
</body>
</html>
